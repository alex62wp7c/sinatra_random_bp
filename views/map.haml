- @map_page = MapPresenter.new(@app.dataset)
= partial(:_nav)
#map
  :javascript
    var map = L.map('map');
    map.locate({setView: true, maxZoom: 16});
    var data = #{@map_page.leaflet_geojson}

    function onLocationFound(e) {
      var radius = e.accuracy / 2;
      L.marker(e.latlng).addTo(map)
        .bindPopup("You are here").openPopup();
      L.circle(e.latlng, radius).addTo(map);
    }

    map.on('locationfound', onLocationFound);

    function onEachFeature(feature, layer) {
      // does this feature have a property named popupContent?
      if (feature.properties && feature.properties.popupContent) {
        layer.bindPopup(feature.properties.popupContent);
      }
    }

    L.tileLayer(#{FakeApp.getRandomTiles}).addTo(map);

    L.geoJson(data,
             {onEachFeature: onEachFeature}
    ).addTo(map);
